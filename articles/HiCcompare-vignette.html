<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HiCcompare Usage Vignette • HiCcompare</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="HiCcompare Usage Vignette">
<meta property="og:description" content="HiCcompare">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">HiCcompare</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.11.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/HiCcompare-vignette.html">HiCcompare Usage Vignette</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/dozmorovlab/HiCcompare/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="HiCcompare-vignette_files/header-attrs-2.3/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>HiCcompare Usage Vignette</h1>
                        <h4 class="author">John Stansfield, Mikhail Dozmorov</h4>
            
            <h4 class="date">2020-08-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/dozmorovlab/HiCcompare/blob/master/vignettes/HiCcompare-vignette.Rmd"><code>vignettes/HiCcompare-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>HiCcompare-vignette.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p><code>HiCcompare</code> provides functions for the joint normalization and detection of differential chromatin interactions between two or multiple Hi-C datasets. <code>HiCcompare</code> operates on processed Hi-C data in the form of chromosome-specific chromatin interaction matrices. It accepts three-column tab-separated text files storing chromatin interaction matrices in a sparse matrix format (see <a href="#hic_table">Creating the hic.table object</a>). Functions to convert popular Hi-C data formats (<code>.hic</code>, <code>.cool</code>) to sparse format are available (see ?cooler2sparse). <code>HiCcompare</code> differs from other packages that attempt to compare Hi-C data in that it works on processed data in chromatin interaction matrix format instead of pre-processed sequencing data. In addition, <code>HiCcompare</code> provides a non-parametric method for the joint normalization and removal of biases between two Hi-C datasets for the purpose of comparative analysis. <code>HiCcompare</code> also provides a simple yet robust permutation method for detecting differences between Hi-C datasets.</p>
<p>The <code>hic_loess</code> function outputs normalized chromatin interactions for both matrices ready for the comparative analysis. The <code>hic_compare</code> function performs the comparative analysis and outputs genomic coordinates of pairs of regions detected as differentially interacting, interaction frequencies, the difference and the corresponding permutation p-value.</p>
</div>
<div id="how-to-use-hiccompare" class="section level1">
<h1 class="hasAnchor">
<a href="#how-to-use-hiccompare" class="anchor"></a>How to use <code>HiCcompare</code>
</h1>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Install <code>HiCcompare</code> from Bioconductor.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co">if</span> (<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span>(<span class="st">"BiocManager"</span>, quietly=<span class="fl">TRUE</span>))
    <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"BiocManager"</span>)
<span class="kw">BiocManager</span>::<span class="fu"><a href="https://rdrr.io/pkg/BiocManager/man/install.html">install</a></span>(<span class="st">"HiCcompare"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">HiCcompare</span>)
</pre></div>
</div>
<div id="getting-hi-c-data" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-hi-c-data" class="anchor"></a>Getting Hi-C Data</h2>
<p>You will need processed Hi-C data in the form of sparse upper triangular matrices or BEDPE files in order to use <code>HiCcompare</code>. Data is available from several sources and two examples for downloading and extracting data are listed below. If you have full Hi-C contact matrices you can convert them to sparse upper triangular format using the full <code>full2sparse</code> function as shown in <a href="#addfunc">additional functions</a></p>
<div id="extracting-data-from--hic-files" class="section level3">
<h3 class="hasAnchor">
<a href="#extracting-data-from--hic-files" class="anchor"></a>Extracting data from <code>.hic</code> files</h3>
<p>Hi-C data is available from several sources and in many formats. <code>HiCcompare</code> is built to work with the sparse upper triangular matrix format popularized by the lab of Erez Lieberman-Aiden <a href="http://aidenlab.org/data.html">http://aidenlab.org/data.html</a>. If you already have Hi-C data either in the form of a sparse upper triangular matrix or a full contact matrix you can skip to the <a href="#hic_table">Creating the hic.table object</a> section. If you obtain data from the Aiden Lab in the <code>.hic</code> format you will need to first extract the matrices that you wish to compare.</p>
<ol style="list-style-type: decimal">
<li>Download the <code>straw</code> software from <a href="https://github.com/theaidenlab/straw/wiki">https://github.com/theaidenlab/straw/wiki</a> and install it.</li>
<li>Use <code>straw</code> to extract a Hi-C sparse upper triangular matrix. An example is below:</li>
</ol>
<p>Say we downloaded the <code>GSE63525_K562_combined_30.hic</code> file from GEO <a href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE63525">https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE63525</a></p>
<p>To extract the raw matrix corresponding to chromosome 22 at 500kb resolution we would use the following command within the terminal</p>
<p><code>./straw NONE GSE63525_K562_combined_30.hic  22 22 BP 500000 &gt; K562.chr22.500kb.txt</code></p>
<p>This will extract the matrix from the <code>.hic</code> file and save it to the <code>K562.chr22.500kb.txt</code> text file, in the sparse upper triangular matrix format. See more examples on on how to use <code>straw</code> at <a href="https://github.com/theaidenlab/straw/wiki/CPP#running">https://github.com/theaidenlab/straw/wiki/CPP#running</a>. Straw requires several inputs for the extraction of data from a <code>.hic</code> file.</p>
<p><code>&lt;NONE/VC/VC_SQRT/KR&gt; &lt;hicFile(s)&gt; &lt;chr1&gt;[:x1:x2] &lt;chr2&gt;[:y1:y2] &lt;BP/FRAG&gt; &lt;binsize&gt;</code></p>
<p>The first argument is the normalization method. For use in <code>HiCcompare</code> you want the raw data so you should selected <code>NONE</code>. The second argument is the <code>.hic</code> file name. Next is the chromosome numbers of the matrix you want. For an intrachromosomal contact map both should be the same as in the above example. If you want a matrix of interchromosomal interactions you can use different chromosomes i.e. interactions between chromosome 1 and chromosome 2 (Note that <code>HiCcompare</code> is only meant to be used on intrachromosomal interactions at this point in development). The next argument is whether you want basepair or fragment files. For <code>HiCcompare</code> use <code>BP</code>. The final argument is the binsize of the matrix (the resolution). To extract a matrix at a resolution of 1MB enter <code>10000000</code>. Typical bin sizes are 1MB, 500KB, 100KB, 50KB, 5KB, 1KB. Note that most matrices with resolutions higher than 100KB (i.e. matrices with resolutions of 1KB - 50KB) are typically too sparse (due to insufficient sequencing coverage) for analysis in <code>HiCcompare</code>.</p>
<p>From here we can just import the matrix into R as you would normally for any tab-delimited file.</p>
<ol start="3" style="list-style-type: decimal">
<li>Import the data into R <code>K562.chr22 &lt;- read.table('K562.chr22.500kb.txt', header=FALSE)</code>
</li>
<li>Repeat these steps for any other Hi-C dataset that you wish to compare to the first dataset using <code>HiCcompare</code>, then proceed to <a href="#hic_table">Creating the <code>hic.table</code> object</a>.</li>
</ol>
</div>
<div id="extracting-data-from--cool-files" class="section level3">
<h3 class="hasAnchor">
<a href="#extracting-data-from--cool-files" class="anchor"></a>Extracting data from <code>.cool</code> files</h3>
<p>The <code>cooler</code> software, <a href="http://cooler.readthedocs.io/en/latest/index.html">http://cooler.readthedocs.io/en/latest/index.html</a>, allows access to a large collection of Hi-C data. The cooler index <a href="ftp://cooler.csail.mit.edu/coolers">ftp://cooler.csail.mit.edu/coolers</a> contains Hi-C data for <code>hg19</code> and <code>mm9</code> from many different sources.</p>
<p><code>.cool</code> files can be read directly into R using the <code>cooler2bedpe</code> function provided by <code>HiCcompare</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cooler2bedpe.html">cooler2bedpe</a></span>(path = <span class="st">"Dixon2012-H1hESC-HindIII-allreps-filtered.1000kb.cool"</span>)
</pre></div>
<p>Alternatively, data in the <code>.cool</code> format can be import into <code>HiCcompare</code> using the following steps:</p>
<ol style="list-style-type: decimal">
<li>Download and install <code>cooler</code> from <a href="http://cooler.readthedocs.io/en/latest/index.html">http://cooler.readthedocs.io/en/latest/index.html</a>
</li>
<li>Download a <code>.cool</code> file from the cooler index <a href="ftp://cooler.csail.mit.edu/coolers">ftp://cooler.csail.mit.edu/coolers</a>.</li>
<li>Say we downloaded the <code>Dixon2012-H1hESC-HindIII-allreps-filtered.1000kb.cool</code> file. See <code>cooler dump --help</code> for data extraction options. To extract the contact matrix we use the following commands in the terminal:<br><code>cooler dump --join Dixon2012-H1hESC-HindIII-allreps-filtered.1000kb.cool &gt; dixon.hESC.1000kb.txt</code>
</li>
<li>Read in the text file as you would any tab-delimited file in R<br><code>hesc1000kb &lt;- read.table("dixon.hESC.1000kb.txt", header = FALSE)</code>
</li>
<li>Convert to a sparse upper triangular matrix using the <code><a href="../reference/cooler2sparse.html">HiCcompare::cooler2sparse</a></code> function.<br><code>sparse &lt;- cooler2sparse(hesc1000kb)</code>
</li>
<li>Repeat the steps for another Hi-C dataset that you wish to compare to the first dataset then proceed to <a href="#hic_table">Creating the <code>hic.table</code> object</a>.</li>
</ol>
</div>
<div id="using-data-from-hic-pro" class="section level3">
<h3 class="hasAnchor">
<a href="#using-data-from-hic-pro" class="anchor"></a>Using data from HiC-Pro</h3>
<p>HiC-Pro is another tool for processing raw Hi-C data into usable matrix files. HiC-Pro will produce a <code>.matrix</code> file and a <code>.bed</code> file for the data. These <code>.matrix</code> files are in sparse upper triangular format similar to the results of Juicer and the dumped contents of a <code>.hic</code> file, however instead of using the genomic start coordinates for the first two columns of the sparse matrix they use an ID number. The <code>.bed</code> file contains the mappings for each of these IDs to their genomic coordinates. <code>HiCcompare</code> includes a function to convert the results of HiC-Pro into a usable format for analysis in <code>HiCcompare</code>. When using data from HiC-Pro it is important to use the raw <code>.matrix</code> files and NOT the iced <code>.matrix</code> files. The iced <code>.matrix</code> files have already had ICE normalization applied to them and are not suitable for entry into <code>HiCcompare</code>. Here we convert HiC-Pro data for input into HiCcompare:</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co"># read in files</span>
<span class="kw">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="st">"hic_1000000.matrix"</span>)
<span class="kw">bed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="st">"hic_1000000_abs.bed"</span>)
<span class="co"># convert to BEDPE</span>
<span class="kw">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hicpro2bedpe.html">hicpro2bedpe</a></span>(<span class="kw">mat</span>, <span class="kw">bed</span>)
<span class="co"># NOTE: hicpro2bedpe returns a list of lists. The first list, dat$cis, contains the intrachromosomal contact matrices</span>
<span class="co"># NOTE: dat$trans contains the interchromosomal contact matrix which is not used in HiCcompare.</span>
</pre></div>
<p>See the help using <code><a href="../reference/hicpro2bedpe.html">?hicpro2bedpe</a></code> for more details.</p>
</div>
</div>
<div id="detecting-copy-number-variations-and-excluding-regions" class="section level2">
<h2 class="hasAnchor">
<a href="#detecting-copy-number-variations-and-excluding-regions" class="anchor"></a>Detecting Copy Number Variations and Excluding regions</h2>
<p>Before you start a <code>HiCcompare</code> analysis, you may want to detect CNV and exclude these regions along with any other regions known to exhibit changes or undesirable sequencing characteristics which could cause false positives. <code>HiCcompare</code> provides a function to perform a CNV detection analysis utilizing the <code>QDNAseq</code> R package. You will need to have your Hi-C data in <code>.bam</code> files. This can be accomplished by downloading the raw sequencing results and aligning them using one of the many Hi-C processing pipelines. Once you have <code>.bam</code> files place them in a specified folder and you can then run <code>get_CNV</code>. Make sure to specify the bin size you will be using in kilobase pairs. The bin size should be the same as the resolution of the Hi-C data that will be used in the <code>HiCcompare</code> analysis. The <code>CNV.level</code> option will allow you to choose which level of CNV you would like to exclude. The CNV calls are defined as -2 = deletion, -1 = loss, 0 = normal, 1 = gain, 2 = amplification. In order to exclude amplifications and deletions set <code>CNV.level = 2</code>. To exclude any amount of CNV set <code>CNV.level = 1</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">cnv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_CNV.html">get_CNV</a></span>(path2bam = <span class="st">'path/to/bamfiles'</span>, out.file = <span class="st">'path/to/bamfiles/outfile'</span>, 
               bin.size = <span class="fl">1000</span>, genome = <span class="st">'hg19'</span>, CNV.level = <span class="fl">2</span>)
</pre></div>
<p>This function will run the CNV detection steps provided in <code>QDNAseq</code> and export a <code>.txt</code> file containing the copy number calls and a <code>.bed</code> file containing the regions detected at or above the chosen CNV level. It will also return a data.frame containing the regions at or above the chosen CNV level. It is recommended to exclude regions with scores of -2 or 2, however this decision is left up to the user.</p>
<p>You may want to exclude the regions with CNV along with blacklisted regions from any further analysis. <code>HiCcompare</code> has the ENCODE blacklists for hg19 and hg38 included (available using <code><a href="https://rdrr.io/r/utils/data.html">data("hg19_blacklist")</a></code> or <code><a href="https://rdrr.io/r/utils/data.html">data("hg38_blacklist")</a></code>). We can now create a data.frame (or <code>GenomicRanges</code> object) containing all of the regions we want to exclude from any further analysis.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">'hg19_blacklist'</span>)

<span class="co"># combine cnv excluded regions with blacklist regions</span>
<span class="kw">exclude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw">cnv</span>, <span class="kw">hg19_blacklist</span>)
</pre></div>
<p>Now that we have a data.frame containing the regions to be excluded we just simply set the <code>exclude.regions</code> options in the <code>create.hic.table</code> function to the <code>exclude</code> data.frame.</p>
</div>
<div id="hic_table" class="section level2">
<h2 class="hasAnchor">
<a href="#hic_table" class="anchor"></a>Creating the <code>hic.table</code> object</h2>
<div id="sparse-upper-triangular-format" class="section level3">
<h3 class="hasAnchor">
<a href="#sparse-upper-triangular-format" class="anchor"></a>Sparse upper triangular format</h3>
<p>A sparse matrix format represents a relatively compact and human-readable way to store pair-wise interactions. It is a tab-delimited text format containing three columns: “region1” - a start coordinate (in bp) of the first region, “region2” a start coordinate of the second region, and “IF” - the interaction frequency between them (IFs). Zero IFs are dropped (hence, the <em>sparse</em> format). Since the full matrix of chromatin interactions is symmetric, only the upper triangular portion, including the diagonal, is stored.</p>
<p>If you have two full Hi-C contact matrices you can convert them to sparse upper triangular matrices using the <code><a href="../reference/full2sparse.html">HiCcompare::full2sparse</a></code> function. Once you have two sparse matrices you are ready to create a <code>hic.table</code> object. This will be illustrated using the included sparse matrices at 500kb resolution for chromosome 22 from the HMEC and NHEK cell lines.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">`HiCcompare`</span>)
<span class="co"># load the data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"HMEC.chr22"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"NHEK.chr22"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">HMEC.chr22</span>)
</pre></div>
<pre><code>##    region1  region2   IF
## 1 16000000 16000000    5
## 2 16000000 16500000    2
## 3 16500000 16500000  297
## 4 16000000 17000000    5
## 5 16500000 17000000   92
## 6 17000000 17000000 5690</code></pre>
<p>Now that we have 2 sparse upper triangular matrices we can create the <code>hic.table</code> object. <code>create.hic.table</code> requires the input of 2 sparse matrices and the chromosome name.</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="co"># create the `hic.table` object</span>
<span class="kw">chr22.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.hic.table.html">create.hic.table</a></span>(<span class="kw">HMEC.chr22</span>, <span class="kw">NHEK.chr22</span>, chr = <span class="st">'chr22'</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">chr22.table</span>)
</pre></div>
<pre><code>##     chr1   start1     end1  chr2   start2     end2  IF1         IF2 D          M
## 1: chr22 16000000 16500000 chr22 16000000 16500000    5    5.203323 0 0.05750528
## 2: chr22 16000000 16500000 chr22 16500000 17000000    2    8.672206 1 2.11639897
## 3: chr22 16500000 17000000 chr22 16500000 17000000  297  480.440193 0 0.69389392
## 4: chr22 16000000 16500000 chr22 17000000 17500000    5   14.742750 2 1.56000562
## 5: chr22 16500000 17000000 chr22 17000000 17500000   92  277.510581 1 1.59283701
## 6: chr22 17000000 17500000 chr22 17000000 17500000 5690 9435.359752 0 0.72964887</code></pre>
<p>By default, all regions for the data entered are used as is. It may be desirable to exclude certain regions from any further analysis because they contain CNV or are overlapping blacklisted regions with known sequencing issues. To exclude the CNV and blacklisted regions we defined above, create the <code>hic.table</code> object as follows.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">chr22.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.hic.table.html">create.hic.table</a></span>(<span class="kw">HMEC.chr22</span>, <span class="kw">NHEK.chr22</span>, chr = <span class="st">'chr22'</span>, exclude.regions = <span class="kw">exclude</span>, exclude.overlap = <span class="fl">0.2</span>)
</pre></div>
<p>The <code>exclude.overlap</code> option controls the percentage overlap required with the regions listed in your data in order to be exclude. CNV regions should in the same resolution and bins as your data so they will overlap any of your regions by 100%. Blacklisted regions tend to be small and may only overlap your regions by a few basepairs. If you want any amount of overlap to result in exclusion set <code>exclude.overlap = 0</code>. To require 100% overlap before exclusion set <code>exclude.overlap = 1</code>. By default this option will exclude regions with 20% or more overlap.</p>
<p>We can also list multiple <code>hic.tables</code> in order to utilize parallel computing. First we create another <code>hic.table</code> as was done above. Then we combine these two <code>hic.tables</code> into a list.</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="co"># create list of `hic.table` objects</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"HMEC.chr10"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"NHEK.chr10"</span>)

<span class="co"># create the `hic.table` object</span>
<span class="kw">chr10.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.hic.table.html">create.hic.table</a></span>(<span class="kw">HMEC.chr10</span>, <span class="kw">NHEK.chr10</span>, chr = <span class="st">'chr10'</span>)
<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">chr10.table</span>, <span class="kw">chr22.table</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">hic.list</span>)
</pre></div>
<pre><code>## [[1]]
##         chr1    start1      end1  chr2    start2      end2   IF1          IF2 D          M
##     1: chr10         0    500000 chr10         0    500000 11160 1.491828e+04 0  0.4187441
##     2: chr10         0    500000 chr10    500000   1000000  3339 4.766792e+03 1  0.5136024
##     3: chr10    500000   1000000 chr10    500000   1000000 15871 1.998235e+04 0  0.3323333
##     4: chr10         0    500000 chr10   1000000   1500000  1064 6.501731e+02 2 -0.7106025
##     5: chr10    500000   1000000 chr10   1000000   1500000  2963 2.097443e+03 1 -0.4984269
##    ---                                                                                    
## 35366: chr10 134000000 134500000 chr10 135000000 135500000  1810 1.273570e+03 2 -0.5071112
## 35367: chr10 134500000 135000000 chr10 135000000 135500000  1971 3.634653e+03 1  0.8828898
## 35368: chr10 135000000 135500000 chr10 135000000 135500000 16716 1.188368e+04 0 -0.4922479
## 35369: chr10 134000000 134500000 chr10 135500000 136000000     1 6.865608e-01 3 -0.5425406
## 35370: chr10 135000000 135500000 chr10 135500000 136000000     4 3.432804e+00 1 -0.2206125
## 
## [[2]]
##        chr1   start1     end1  chr2   start2     end2  IF1         IF2 D           M
##    1: chr22 16000000 16500000 chr22 16000000 16500000    5    5.203323 0  0.05750528
##    2: chr22 16000000 16500000 chr22 16500000 17000000    2    8.672206 1  2.11639897
##    3: chr22 16500000 17000000 chr22 16500000 17000000  297  480.440193 0  0.69389392
##    4: chr22 16000000 16500000 chr22 17000000 17500000    5   14.742750 2  1.56000562
##    5: chr22 16500000 17000000 chr22 17000000 17500000   92  277.510581 1  1.59283701
##   ---                                                                               
## 2479: chr22 49000000 49500000 chr22 51000000 51500000   21   54.634896 4  1.37943338
## 2480: chr22 49500000 50000000 chr22 51000000 51500000   35   71.112086 3  1.02273986
## 2481: chr22 50000000 50500000 chr22 51000000 51500000  394  339.083241 2 -0.21655615
## 2482: chr22 50500000 51000000 chr22 51000000 51500000 4066 2741.284207 1 -0.56875831
## 2483: chr22 51000000 51500000 chr22 51000000 51500000 9916 7132.021930 0 -0.47544713</code></pre>
<p>The <code>hic.table</code> object contains a summary of the differences between the two matrices. “IF1” and “IF2” correspond to interaction frequencies in the first and second matrices, “D” is the unit distance (length of each unit is equivalent to the resolution of the data, e.g., 500kb), “M” is the <span class="math inline">\(log_2(IF2)-log_2(IF1)\)</span> difference.</p>
</div>
<div id="bedpe-format" class="section level3">
<h3 class="hasAnchor">
<a href="#bedpe-format" class="anchor"></a>BEDPE format</h3>
<p>A <code>hic.table</code> object can also be created using data in the 7 column BEDPE format. An example of BEDPE data for the HMEC dataset used above is shown below.</p>
<pre><code>##     chr1   start1     end1  chr2   start2     end2  IF1
## 1: chr22 16000000 16500000 chr22 16000000 16500000    5
## 2: chr22 16000000 16500000 chr22 16500000 17000000    2
## 3: chr22 16500000 17000000 chr22 16500000 17000000  297
## 4: chr22 16000000 16500000 chr22 17000000 17500000    5
## 5: chr22 16500000 17000000 chr22 17000000 17500000   92
## 6: chr22 17000000 17500000 chr22 17000000 17500000 5690</code></pre>
<p>To create a <code>hic.table</code> object using BEDPE data is very similar to using data in the sparse upper triangular format.</p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">bed.hic.tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.hic.table.html">create.hic.table</a></span>(<span class="kw">HMEC.chr22_BEDPE</span>, <span class="kw">NHEK.chr22_BEDPE</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">bed.hic.tab</span>)
</pre></div>
<pre><code>##     chr1   start1     end1  chr2   start2     end2  IF1         IF2 D          M
## 1: chr22 16000000 16500000 chr22 16000000 16500000    5    5.203323 0 0.05750528
## 2: chr22 16000000 16500000 chr22 16500000 17000000    2    8.672206 1 2.11639897
## 3: chr22 16500000 17000000 chr22 16500000 17000000  297  480.440193 0 0.69389392
## 4: chr22 16000000 16500000 chr22 17000000 17500000    5   14.742750 2 1.56000562
## 5: chr22 16500000 17000000 chr22 17000000 17500000   92  277.510581 1 1.59283701
## 6: chr22 17000000 17500000 chr22 17000000 17500000 5690 9435.359752 0 0.72964887</code></pre>
</div>
<div id="hic-pro-format" class="section level3">
<h3 class="hasAnchor">
<a href="#hic-pro-format" class="anchor"></a>HiC-Pro format</h3>
<p>If you are using data from HiC-Pro you can create a <code>hic.table</code> object as follows.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="co"># first dataset</span>
<span class="kw">mat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="st">"hic1_1000000.matrix"</span>)
<span class="kw">bed1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="st">"hic1_1000000_abs.bed"</span>)
<span class="kw">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hicpro2bedpe.html">hicpro2bedpe</a></span>(<span class="kw">mat</span>, <span class="kw">bed</span>)
<span class="kw">dat1</span> <span class="op">&lt;-</span> <span class="kw">dat1</span><span class="op">$</span><span class="kw">cis</span> <span class="co"># extract intrachromosomal matrices</span>
<span class="co"># second dataset</span>
<span class="kw">mat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="st">"hic2_1000000.matrix"</span>)
<span class="kw">bed2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="st">"hic2_1000000_abs.bed"</span>)
<span class="kw">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hicpro2bedpe.html">hicpro2bedpe</a></span>(<span class="kw">mat</span>, <span class="kw">bed</span>)
<span class="kw">dat2</span> <span class="op">&lt;-</span> <span class="kw">dat2</span><span class="op">$</span><span class="kw">cis</span> <span class="co"># extract intrachromosomal matrices</span>

<span class="co"># for chr1</span>
<span class="kw">hic.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.hic.table.html">create.hic.table</a></span>(<span class="kw">dat1</span>[[<span class="fl">1</span>]], <span class="kw">dat2</span>[[<span class="fl">1</span>]])

<span class="co"># for all chromosomes</span>
<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span>(<span class="kw">create.hic.table</span>, <span class="kw">dat1</span>, <span class="kw">dat2</span>, SIMPLIFY = <span class="fl">FALSE</span>)
</pre></div>
</div>
<div id="interactionsetgranges-format" class="section level3">
<h3 class="hasAnchor">
<a href="#interactionsetgranges-format" class="anchor"></a>InteractionSet/GRanges format</h3>
<p>A <code>hic.table</code> can also be created using an <code>InteractionSet</code> object. Simply enter two <code>InteractionSets</code> representing two Hi-C matrices into the <code>create.hic.table</code> function and they will be converted to the proper format. See the <code>InteractionSet</code> vignette for creating <code>InteractionSet</code> objects <a href="https://bioconductor.org/packages/release/bioc/vignettes/InteractionSet/inst/doc/interactions.html">here</a></p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"hmec.IS"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"nhek.IS"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">hmec.IS</span>)
</pre></div>
<pre><code>## GInteractions object with 6 interactions and 1 metadata column:
##       seqnames1           ranges1     seqnames2           ranges2 |        IF
##           &lt;Rle&gt;         &lt;IRanges&gt;         &lt;Rle&gt;         &lt;IRanges&gt; | &lt;numeric&gt;
##   [1]     chr22 16000000-16499999 ---     chr22 16000000-16499999 |         5
##   [2]     chr22 16000000-16499999 ---     chr22 16500000-16999999 |         2
##   [3]     chr22 16500000-16999999 ---     chr22 16500000-16999999 |       297
##   [4]     chr22 16000000-16499999 ---     chr22 17000000-17499999 |         5
##   [5]     chr22 16500000-16999999 ---     chr22 17000000-17499999 |        92
##   [6]     chr22 17000000-17499999 ---     chr22 17000000-17499999 |      5690
##   -------
##   regions: 71 ranges and 0 metadata columns
##   seqinfo: 1 sequence from an unspecified genome; no seqlengths</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="kw">IS.hic.tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create.hic.table.html">create.hic.table</a></span>(<span class="kw">hmec.IS</span>, <span class="kw">nhek.IS</span>)
</pre></div>
<p>To shorten computational time, or if one is only interested in a subsection of a Hi-C matrix, one may wish to use a subset of the <code>hic.table</code> object. Use the <code>subset.dist</code> or <code>subset.index</code> options, see help for the <code>create.hic.table</code> function.</p>
</div>
</div>
<div id="total-sum-scaling" class="section level2">
<h2 class="hasAnchor">
<a href="#total-sum-scaling" class="anchor"></a>Total Sum Scaling</h2>
<p>If you are performing your <code>HiCcompare</code> analysis on the entire genome you can perform total sum scaling on the data before performing loess normalization. This requires the use of a list of <code>hic.table</code> objects, one for each chromosome. Additionally, when you create these <code>hic.table</code> objects you must set <code>scale = FALSE</code>. Once you have your list of <code>hic.table</code> objects you can then perform total sum scaling.</p>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/total_sum.html">total_sum</a></span>(<span class="kw">hic.list</span>)
</pre></div>
<p>It is recommended to use total sum scaling when performing a <code>HiCcompare</code> analysis on the entire genome. If you are only using data for a single chromosome then total sum scaling should be equivalent to the <code>scale</code> option in the <code>create.hic.table</code> function.</p>
</div>
<div id="joint-normalization" class="section level2">
<h2 class="hasAnchor">
<a href="#joint-normalization" class="anchor"></a>Joint Normalization</h2>
<p>Now that you have created a <code>hic.table</code> object you can jointly normalize your two Hi-C matrices. The <code>hic_loess</code> function has many options and can accept a single <code>hic.table</code> or a list of hic.tables. If for example you wish to perform joint normalization for every chromosome on two cell lines while utilizing parallel computing you can create a list containing the hic.tables for each chromosome.</p>
<p>To change the degree of the polynomial for the loess joint normalization you can utilize the <code>degree</code> option, default is 1 (linear regression). A user-defined span, or the amount of data used to build the loess model, can also be set with the <code>span</code> option. However if <code>span = NA</code> (the default) the automatic smoothing parameter selection process will run and determine the optimal span for the data. The type of selection process can be changed using the <code>loess.criterion</code> option. Available settings are <code>gcv</code> (the default) for generalized cross-validation or <code>aicc</code> for Akaike information criterion. The loess automatic smoothing parameter selection uses a customized version of the <code>fANCOVA::loess.as</code> function. For more information on parameter selection please see the <code>fANCOVA</code> reference manual. It is recommended to use the default settings. If you have already run <code>hic_loess</code> on a dataset and know the span or would like to use a specific span then manually setting the span to a value can significantly reduce computation time especially for high resolution data.</p>
<p><code>hic_loess</code> can utilize the <code>BiocParallel</code> package to perform parallel computing and lower computation time. The <code>parallel</code> option (FALSE by default) will only speed up computation if a list of hic.tables is entered into the function, i.e., it parallelizes processing of several chromosome-specific matrices. This is useful for performing joint normalization for every chromosome between two Hi-C datasets. For more information on <code>BiocParallel</code> see the reference manual <a href="http://bioconductor.org/packages/release/bioc/vignettes/BiocParallel/inst/doc/Introduction_To_BiocParallel.pdf">here.</a></p>
<p>The basis of <code>HiCcompare</code> rests on the novel concept termed the MD plot. The MD plot is similar to the MA plot or the Bland-Altman plot. <span class="math inline">\(M\)</span> is the log2 difference between the interaction frequencies from the two datasets. <span class="math inline">\(D\)</span> is the unit distance between the two interacting regions. Loess is performed on the data after it is represented in the MD coordinate system. To visualize the MD plot the <code>Plot</code> option can be set to TRUE.</p>
<p>If you wish to detect differences between the two Hi-C datasets immediately following joint normalization you can set the <code>check.differences</code> option to TRUE. However, if you only want to jointly normalize the data for now keep this option set to FALSE. The difference detection process will be covered in the next section.</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="co"># Jointly normalize data for a single chromosome</span>
<span class="kw">hic.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_loess.html">hic_loess</a></span>(<span class="kw">chr22.table</span>, Plot = <span class="fl">TRUE</span>, Plot.smooth = <span class="fl">FALSE</span>)
</pre></div>
<pre><code>## Span for loess: 0.219052588777294</code></pre>
<pre><code>## GCV for loess: 0.000118686898199309</code></pre>
<pre><code>## AIC for loess: -0.212037314500057</code></pre>
<pre><code>## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'
## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'</code></pre>
<p><img src="HiCcompare-vignette_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">hic.table</span>))
</pre></div>
<table class="table">
<colgroup>
<col width="4%">
<col width="6%">
<col width="6%">
<col width="4%">
<col width="6%">
<col width="6%">
<col width="3%">
<col width="8%">
<col width="2%">
<col width="7%">
<col width="8%">
<col width="8%">
<col width="8%">
<col width="7%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">chr1</th>
<th align="right">start1</th>
<th align="right">end1</th>
<th align="left">chr2</th>
<th align="right">start2</th>
<th align="right">end2</th>
<th align="right">IF1</th>
<th align="right">IF2</th>
<th align="right">D</th>
<th align="right">M</th>
<th align="right">adj.IF1</th>
<th align="right">adj.IF2</th>
<th align="right">adj.M</th>
<th align="right">mc</th>
<th align="right">A</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">chr22</td>
<td align="right">16000000</td>
<td align="right">16500000</td>
<td align="left">chr22</td>
<td align="right">16000000</td>
<td align="right">16500000</td>
<td align="right">5</td>
<td align="right">5.203323</td>
<td align="right">0</td>
<td align="right">0.0575053</td>
<td align="right">5.103586</td>
<td align="right">5.097713</td>
<td align="right">-0.0016611</td>
<td align="right">0.0591664</td>
<td align="right">5.100650</td>
</tr>
<tr class="even">
<td align="left">chr22</td>
<td align="right">16000000</td>
<td align="right">16500000</td>
<td align="left">chr22</td>
<td align="right">16500000</td>
<td align="right">17000000</td>
<td align="right">2</td>
<td align="right">8.672206</td>
<td align="right">1</td>
<td align="right">2.1163990</td>
<td align="right">2.079392</td>
<td align="right">8.341096</td>
<td align="right">2.0040748</td>
<td align="right">0.1123242</td>
<td align="right">5.210244</td>
</tr>
<tr class="odd">
<td align="left">chr22</td>
<td align="right">16500000</td>
<td align="right">17000000</td>
<td align="left">chr22</td>
<td align="right">16500000</td>
<td align="right">17000000</td>
<td align="right">297</td>
<td align="right">480.440193</td>
<td align="right">0</td>
<td align="right">0.6938939</td>
<td align="right">303.153008</td>
<td align="right">470.688840</td>
<td align="right">0.6347275</td>
<td align="right">0.0591664</td>
<td align="right">386.920924</td>
</tr>
<tr class="even">
<td align="left">chr22</td>
<td align="right">16000000</td>
<td align="right">16500000</td>
<td align="left">chr22</td>
<td align="right">17000000</td>
<td align="right">17500000</td>
<td align="right">5</td>
<td align="right">14.742750</td>
<td align="right">2</td>
<td align="right">1.5600056</td>
<td align="right">5.294664</td>
<td align="right">13.922271</td>
<td align="right">1.3947836</td>
<td align="right">0.1652220</td>
<td align="right">9.608468</td>
</tr>
<tr class="odd">
<td align="left">chr22</td>
<td align="right">16500000</td>
<td align="right">17000000</td>
<td align="left">chr22</td>
<td align="right">17000000</td>
<td align="right">17500000</td>
<td align="right">92</td>
<td align="right">277.510581</td>
<td align="right">1</td>
<td align="right">1.5928370</td>
<td align="right">95.652053</td>
<td align="right">266.915059</td>
<td align="right">1.4805129</td>
<td align="right">0.1123242</td>
<td align="right">181.283556</td>
</tr>
<tr class="even">
<td align="left">chr22</td>
<td align="right">17000000</td>
<td align="right">17500000</td>
<td align="left">chr22</td>
<td align="right">17000000</td>
<td align="right">17500000</td>
<td align="right">5690</td>
<td align="right">9435.359752</td>
<td align="right">0</td>
<td align="right">0.7296489</td>
<td align="right">5807.880851</td>
<td align="right">9243.853028</td>
<td align="right">0.6704825</td>
<td align="right">0.0591664</td>
<td align="right">7525.866939</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="co"># Multiple hic.tables can be processed in parallel by entering a list of hic.tables</span>
<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_loess.html">hic_loess</a></span>(<span class="kw">hic.list</span>, parallel = <span class="fl">TRUE</span>)
</pre></div>
<p>The <code>hic_loess</code> joint normalization function extends the <code>hic.table</code> with the adjusted interaction frequencies, adjusted “M”, the “mc” correction factor, and the average expression “A”.</p>
<!-- ## Weighting of M values -->
<!-- This is an optional step of the analysis process for advanced users. This step will require the user to look at several plots to decide if weighting is necessary and if so, decide on the input parameters for the weighting. Weighting of M values may not be necessary for data at low resolutions such as 1MB or 500KB. For higher resolution data this process will probably be more necessary. However, you will need to look at the data and plots in order to determine this for yourself. If you perform a standard `HiCcompare` analysis without weighting of M values on your data and find that a large number of detected differences have low average expression it may be helpful to use M weighting. -->
<!-- M values are defined as $log2(IF2 / IF1)$. Since M values are the result of a ratio, differences on the log scale can appear identical when on the raw scale they are actually very different. For instance The M values for IF1 = 1 and IF2 = 10 and for IF1 = 10 and IF2 = 100 are both 3.32, despite the fact that the second pair of interaction frequencies has a much larger difference on the raw scale. This could potentially lead to issues in the analysis of Hi-C data, as IFs with lower average expression values are less trustworthy and more prone to display differences due solely to chance or technical biases rather than true biological differences. Therefore, M values derived from IFs with large average expression should be treated as more trustworthy than those derived from IFs exhibiting small average expression. One solution to this issue to weight M values based on their corresponding average expression before performing difference detection.  -->
<!-- To weight M values, first we calculate the average expression associated with each M value, $A = (IF1 + IF2) / 2$. Simple plotting of A values indicates that average expression between two Hi-C datasets is roughly distributed in a powerlaw fashion, with the majority of A values being rather small and a long right tail of very large A values. A values less than 1 should not be trusted at all and so they can safely be ignored for now. At this point we will need to plot the distribution of A in order to determine a minimum value of A at which to start the weighting and at which quantile of A we should stop weighting. -->
<!-- We can plot the distribution of A using the `plot_A` function on a list of hic.table objects. Here we use Hi-C data comparing two different regions of the brain for chromosomes 18 and 22 at 100KB resolution. The data has already been read into a `hic.table` list and jointly normalized with `hic_loess`.  -->
<!-- ```{r, fig.height=8, fig.width=6, warning=FALSE, message=FALSE} -->
<!-- data("brain_table") -->
<!-- aplot <- plot_A(brain_table) -->
<!-- ``` -->
<!-- From looking at the plots we can see that the density levels out by the 75th quantile so we can focus on the values of A < 75th quantile. Next we will need to determine the minimum value of A at which to start fitting the powerlaw for weighting. From the 4th plot we can see that after a value of 4 the density of A starts to more or less uniformly decrease so this should be a safe guess for the minimum A value. The peak of the log2(A) histogram looks to occur at about 1.5 so if we take the anti-log we get 2.8 further suggesting that a value between 2.8 and 4 should be okay for fitting the weights.  -->
<!-- Now we can perform weighting of the M values. -->
<!-- ```{r, warning=FALSE} -->
<!-- brain_table <- weight_M(brain_table, A.min = 4, quant = 0.75, Plot.diagnostic = TRUE, Plot.MD = TRUE) -->
<!-- ``` -->
<!-- The diagnostic plots are the histogram of raw A values between the `A.min` value and the `quant` quantile. The solid line represents the powerlaw fit to the density. You should always check these plots to make sure the fit of the weights is okay. You can also see the new MD plots after M weighting above. The diagnostic plots indicate that the parameters chosen worked for the data. You can now proceed to difference detection on your data.  -->
<!-- Weighting of the M values occurs as follows. We estimate the kernel density for the A values which fall into the range $A \le A_{min} \ and \ A < A_{quant}$. The approximate probability density function, $f_A(.)$, of the kernel density is then interpolated from the kernel density. Next, we fit a powerlaw to this subset of A. The powerlaw is defined as $P(A) = cA^{-\alpha}$. We get the best fit of the powerlaw to the kernel density by minimizing the sum of squared residuals (SSR) between the powerlaw fit and the kernel density. The weights, $w$, can be calculated as follows -->
<!-- $$w = \begin{cases} 0, \  A < A_{min} \\ -->
<!-- 1 - \frac{P(A)}{max(P(A))}, \ A_{min} \le A < A_{0.75} \\ -->
<!-- 1, \ A \ge A_{0.75} -->
<!-- \end{cases} -->
<!-- $$ -->
<!-- where $P(A)$ is the powerlaw fit based on the minimizing the SSR. This weighting scheme will produce weights on [0, 1] corresponding to the powerlaw fit to the estimated kernel density of A. The weights can then be multiplied to the normalized M values before difference detection is performed. The weights can only make the M values closer to 0 and thus the differences represented will become less significant if their corresponding A value is low. M values corresponding to high A values will be unchanged.  -->
</div>
<div id="difference-detection" class="section level2">
<h2 class="hasAnchor">
<a href="#difference-detection" class="anchor"></a>Difference Detection</h2>
<!-- Difference detection also makes use of the MD plot. The jointly normalized datasets are once again plotted on the MD plot. Difference detection takes place on a per-unit-distance basis using a permutation test. Permutations are broken into blocks for each unit distance. See methods section of the manuscript [here](https://doi.org/10.1101/147850) for more details. Difference detection can be performed at the same time as joint normalization if the `check.differences` option in `hic_loess` is set to TRUE. Otherwise a `hic.table` object output from the `hic_loess` function can be input into the `hic_diff` function for difference detection.  -->
<!-- `hic_diff` accepts a `hic.table` object or a list of hic.table objects output from `hic_loess`. `hic_diff` can also utilize the `BiocParallel` package the same way as the `hic_loess` loess function. The same limits and uses apply as stated above. If the `Plot` option is set to TRUE, an MD plot will be displayed showing the normalized MD plot along with coloring based on the significance of each difference. The dotted lines on this MD plot represent the `diff.thresh` threshold. This threshold is automatically calculated as 2 standard deviations of M from 0 on the MD plot by default but can be set by the user or turned off. This option helps to deal with false positives by restricting the regions that can be labelled as significant when they fall inside the threshold. The threshold can be thought of as a range in which differences do not exceed the level of the expected noise in the Hi-C data. If you used M weighting on your data you should use a `diff_thresh` otherwise you will get many false positives for longer range interactions. The function will return a hic.table or a list of hic.tables with an additional column containing the p-value for the significance of the difference between the IFs in each cell of the two Hi-C matrices.  -->
<!-- If you wish to visualize the p-values in the form of a Hi-C contact map you can use the `visualize_pvals` function to transform the results to a contact matrix with the p-values inserted instead of IFs as illustrated in the example below. The `visualize_pvals` function will multiply the -log10 p-value by 1 if the fold change for that interaction is positive or by -1 if the fold change is negative thus allowing for differentiation between regions that display either an increase or decrease in interaction frequencies. -->
<!-- ```{r, fig.width=7, fig.height=6, warning=FALSE, message = FALSE} -->
<!-- # input hic.table object into hic_diff -->
<!-- hic.table <- hic_diff(hic.table, Plot = TRUE, Plot.smooth = FALSE) -->
<!-- # input a list of hic.tables -->
<!-- hic.list <- hic_diff(hic.list) -->
<!-- # visualize results as contact map of p-values -->
<!-- visualize_pvals(hic.table) -->
<!-- ``` -->
<p>the MD plot is used to represent the differences <span class="math inline">\(M\)</span> between two normalized datasets at a distance <span class="math inline">\(D\)</span>. Normalized <span class="math inline">\(M\)</span> values are centered around 0 and the distribution at each distance remains fairly consistent. The <span class="math inline">\(M\)</span> values are approximately normally distributed. <span class="math inline">\(M\)</span> values are converted to Z-scores using the standard approach:</p>
<p><span class="math display">\[
Z_i = \frac{M_i - \bar{M}}{\sigma_M}
\]</span> where <span class="math inline">\(\bar{M}\)</span> is the mean value of all <span class="math inline">\(M\)</span>’s on the chromosome and <span class="math inline">\(\sigma_M\)</span> is the standard deviation of all <span class="math inline">\(M\)</span> values on the chromosome and <span class="math inline">\(i\)</span> is the <span class="math inline">\(i\)</span>th interacting pair on the chromosome.</p>
<p>During Z-score conversion the average expression of each interacting pair is considered. Due to the nature of <span class="math inline">\(M\)</span>, a difference represented by an interacting pair with IFs 1 and 10 is equivalent to an interacting pair of IFs 10 and 100 with both differences having an <span class="math inline">\(M\)</span> value of 3.32. However the average expression of these two differences is 5.5 and 55, respectively. Differences with higher average expression are more trustworthy than those with low average expression due to the fact that a relatively small difference on the raw scale can lead to a large log2 fold change. Additionally since the IFs represent Hi-C sequencing reads, lower average numbers of reads are also less trustworthy. Thus we filter out differences with low average expression before calculating Z-scores when average expression (<span class="math inline">\(A\)</span>) is less than a user set quantile (typically 5-20%) or a user set specific value of <span class="math inline">\(A\)</span>. The Z-scores can then be converted to p-values using the standard normal distribution.</p>
<p>To determine how to filter your data you can use the <code><a href="../reference/filter_params.html">filter_params()</a></code> function. This will produce a plot of the Matthews Correlation Coefficient (MCC) vs. the A minimum value filtered out. This plot should help you determine a reasonable value to set your filtering parameter in <code>hic_compare</code>. You may need to adjust the <code>numChanges</code> option and the <code>FC</code> option depending on the resolution of the data and how noisy it is.</p>
<p>Here we check the filtering:</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="fu"><a href="../reference/filter_params.html">filter_params</a></span>(<span class="kw">hic.table</span>)
</pre></div>
<p><img src="HiCcompare-vignette_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>Difference detection can be performed using the <code><a href="../reference/hic_compare.html">hic_compare()</a></code> function. Before difference detection you will need to decide how you would like to filter out interactions with low average expression. You can filter based on a specific value of A. Once you have a normalized <code>hic.table</code> or list of <code>hic.tables</code> detect differences with an A filter as follows:</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="kw">hic.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_compare.html">hic_compare</a></span>(<span class="kw">hic.table</span>, A.min = <span class="fl">15</span>, adjust.dist = <span class="fl">TRUE</span>, p.method = <span class="st">'fdr'</span>, Plot = <span class="fl">TRUE</span>)
</pre></div>
<pre><code>## Filtering out interactions with A &lt; 15</code></pre>
<p><img src="HiCcompare-vignette_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>If you leave the <code>A.min = NA</code> then the 10th percentile of A will be calculated and used for filtering by default. The resulting table will display the results as shown below:</p>
<div class="sourceCode" id="cb31"><pre class="downlit">
<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">hic.table</span>))
</pre></div>
<table class="table">
<colgroup>
<col width="3%">
<col width="5%">
<col width="5%">
<col width="3%">
<col width="5%">
<col width="5%">
<col width="3%">
<col width="7%">
<col width="1%">
<col width="6%">
<col width="7%">
<col width="7%">
<col width="6%">
<col width="5%">
<col width="7%">
<col width="6%">
<col width="5%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">chr1</th>
<th align="right">start1</th>
<th align="right">end1</th>
<th align="left">chr2</th>
<th align="right">start2</th>
<th align="right">end2</th>
<th align="right">IF1</th>
<th align="right">IF2</th>
<th align="right">D</th>
<th align="right">M</th>
<th align="right">adj.IF1</th>
<th align="right">adj.IF2</th>
<th align="right">adj.M</th>
<th align="right">mc</th>
<th align="right">A</th>
<th align="right">Z</th>
<th align="right">p.value</th>
<th align="right">p.adj</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">chr22</td>
<td align="right">16000000</td>
<td align="right">16500000</td>
<td align="left">chr22</td>
<td align="right">16000000</td>
<td align="right">16500000</td>
<td align="right">5</td>
<td align="right">5.203323</td>
<td align="right">0</td>
<td align="right">0.0575053</td>
<td align="right">5.103586</td>
<td align="right">5.097713</td>
<td align="right">-0.0016611</td>
<td align="right">0.0591664</td>
<td align="right">5.10065</td>
<td align="right">NA</td>
<td align="right">1.0000000</td>
<td align="right">1.0000000</td>
</tr>
<tr class="even">
<td align="left">chr22</td>
<td align="right">16500000</td>
<td align="right">17000000</td>
<td align="left">chr22</td>
<td align="right">16500000</td>
<td align="right">17000000</td>
<td align="right">297</td>
<td align="right">480.440193</td>
<td align="right">0</td>
<td align="right">0.6938939</td>
<td align="right">303.153008</td>
<td align="right">470.688840</td>
<td align="right">0.6347275</td>
<td align="right">0.0591664</td>
<td align="right">386.92092</td>
<td align="right">1.2636692</td>
<td align="right">0.2063488</td>
<td align="right">0.8469872</td>
</tr>
<tr class="odd">
<td align="left">chr22</td>
<td align="right">17000000</td>
<td align="right">17500000</td>
<td align="left">chr22</td>
<td align="right">17000000</td>
<td align="right">17500000</td>
<td align="right">5690</td>
<td align="right">9435.359752</td>
<td align="right">0</td>
<td align="right">0.7296489</td>
<td align="right">5807.880851</td>
<td align="right">9243.853028</td>
<td align="right">0.6704825</td>
<td align="right">0.0591664</td>
<td align="right">7525.86694</td>
<td align="right">1.3334594</td>
<td align="right">0.1823811</td>
<td align="right">0.8469872</td>
</tr>
<tr class="even">
<td align="left">chr22</td>
<td align="right">17500000</td>
<td align="right">18000000</td>
<td align="left">chr22</td>
<td align="right">17500000</td>
<td align="right">18000000</td>
<td align="right">17641</td>
<td align="right">23887.590475</td>
<td align="right">0</td>
<td align="right">0.4373290</td>
<td align="right">18006.472072</td>
<td align="right">23402.751072</td>
<td align="right">0.3781626</td>
<td align="right">0.0591664</td>
<td align="right">20704.61157</td>
<td align="right">0.7628794</td>
<td align="right">0.4455353</td>
<td align="right">0.8469872</td>
</tr>
<tr class="odd">
<td align="left">chr22</td>
<td align="right">18000000</td>
<td align="right">18500000</td>
<td align="left">chr22</td>
<td align="right">18000000</td>
<td align="right">18500000</td>
<td align="right">27241</td>
<td align="right">22369.087265</td>
<td align="right">0</td>
<td align="right">-0.2842733</td>
<td align="right">27805.357163</td>
<td align="right">21915.068475</td>
<td align="right">-0.3434397</td>
<td align="right">0.0591664</td>
<td align="right">24860.21282</td>
<td align="right">-0.6456180</td>
<td align="right">0.5185268</td>
<td align="right">0.8469872</td>
</tr>
<tr class="even">
<td align="left">chr22</td>
<td align="right">18500000</td>
<td align="right">19000000</td>
<td align="left">chr22</td>
<td align="right">18500000</td>
<td align="right">19000000</td>
<td align="right">10592</td>
<td align="right">8412.039485</td>
<td align="right">0</td>
<td align="right">-0.3324475</td>
<td align="right">10811.436550</td>
<td align="right">8241.302792</td>
<td align="right">-0.3916139</td>
<td align="right">0.0591664</td>
<td align="right">9526.36967</td>
<td align="right">-0.7396494</td>
<td align="right">0.4595127</td>
<td align="right">0.8469872</td>
</tr>
</tbody>
</table>
<p>Where <code>Z</code> is the Z-score calculated for the interaction (Z-scores with NA values result from filtering based on A), <code>p.value</code> is the un-adjusted p-value based on the standard normal distribution, and <code>p.adj</code> is the p-value after the multiple testing correction specified was applied.</p>
</div>
<div id="converting-hiccompare-results-to-interactionset-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#converting-hiccompare-results-to-interactionset-objects" class="anchor"></a>Converting <code>HiCcompare</code> results to <code>InteractionSet</code> objects</h2>
<p>If after running <code>hic_loess</code> or <code>hic_compare</code> on your data you wish to perform additional analyses which require the <code>GRanges</code> object class you can convert the results using the <code>make_InteractionSet</code> function. This function will produce an <code>InteractionSet</code> object with the genomic ranges contained in the <code>hic.table</code> along with several metadata files containing the additional information produced by <code>hic_loess</code> or <code>hic_compare</code>.</p>
<div class="sourceCode" id="cb32"><pre class="downlit">
<span class="kw">IntSet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_InteractionSet.html">make_InteractionSet</a></span>(<span class="kw">hic.table</span>)
</pre></div>
</div>
<div id="simulating-hi-c-data" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-hi-c-data" class="anchor"></a>Simulating Hi-C Data</h2>
<p><code>HiCcompare</code> includes functions for simulating Hi-C data. The <code>hic_simulate</code> function allows you to simulate two Hi-C matrices with added bias and true differences at a specified fold change. As an example we will simulate two matrices with 250 true differences added at a fold change of 4.</p>
<div class="sourceCode" id="cb33"><pre class="downlit">
<span class="kw">number_of_unitdistances</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># The dimensions of the square matrix to be simualted</span>
<span class="kw">number_of_changes</span>       <span class="op">&lt;-</span> <span class="fl">250</span> <span class="co"># How many cells in the matrix will have changes</span>
<span class="kw">i.range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span><span class="op">:</span><span class="kw">number_of_unitdistances</span>, <span class="kw">number_of_changes</span>, replace = <span class="fl">TRUE</span>) <span class="co"># Indexes of cells to have controlled changes</span>
<span class="kw">j.range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span><span class="op">:</span><span class="kw">number_of_unitdistances</span>, <span class="kw">number_of_changes</span>, replace = <span class="fl">TRUE</span>) <span class="co"># Indexes of cells to have controlled changes</span>

<span class="kw">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_simulate.html">hic_simulate</a></span>(nrow = <span class="kw">number_of_unitdistances</span>, medianIF = <span class="fl">50000</span>, sdIF = <span class="fl">14000</span>, powerlaw.alpha = <span class="fl">1.8</span>, fold.change = <span class="fl">4</span>, i.range = <span class="kw">i.range</span>, j.range = <span class="kw">j.range</span>, Plot = <span class="fl">TRUE</span>, alpha = <span class="fl">0.1</span>)
</pre></div>
<pre><code>## Span for loess: 0.212770648399734</code></pre>
<pre><code>## GCV for loess: 0.000115595383786921</code></pre>
<pre><code>## AIC for loess: 0.40401939084367</code></pre>
<pre><code>## Filtering out interactions with A &lt; 99</code></pre>
<p><img src="HiCcompare-vignette_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
<pre><code>## True Positives: 211 Total added differences: 213 True Negatives: 4470</code></pre>
<pre><code>## TPR: 0.990610328638498</code></pre>
<pre><code>## SPC: 0.986972841686907</code></pre>
<p><img src="HiCcompare-vignette_files/figure-html/unnamed-chunk-21-2.png" width="672"></p>
<p>The results of the simulation are saved in a list.</p>
<div class="sourceCode" id="cb41"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">sim_results</span>)
</pre></div>
<pre><code>## [1] "TPR"       "SPC"       "pvals"     "hic.table" "true.diff" "truth"     "sim.table"</code></pre>
<p>TPR is the true positive rate, SPC is the specificity, pvals is a vector of the p-values for every cell in the matrices, hic.table is the resulting hic.table object after <code>hic_loess</code> and <code>hic_compare</code> have been applied to the simulated data, true.diff is a table for the cells that had the specified fold change applied to them, truth is a vector of 0’s and 1’s indicating if a cell had a true difference applied - this is useful for input into ROC packages, sim.table is the simulated data in a hic.table object before being scaled, normalized, and analyzed for differences.</p>
<p>The <code>sim_matrix</code> function will produce two simulated Hi-C matrices without performing any analysis.</p>
<div class="sourceCode" id="cb43"><pre class="downlit">
<span class="kw">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_matrix.html">sim_matrix</a></span>(nrow = <span class="kw">number_of_unitdistances</span>, medianIF = <span class="fl">50000</span>, sdIF = <span class="fl">14000</span>, powerlaw.alpha = <span class="fl">1.8</span>, fold.change = <span class="fl">4</span>, 
                   i.range = <span class="kw">i.range</span>, j.range = <span class="kw">j.range</span>)
</pre></div>
</div>
<div id="addfunc" class="section level2">
<h2 class="hasAnchor">
<a href="#addfunc" class="anchor"></a>Additional Functions</h2>
<p><code>HiCcompare</code> contains some additional functions that may be useful.</p>
<p>If you do not choose to show the MD plots when you initially run <code>hic_loess</code> or <code>hic_compare</code> you can use the <code>MD.plot1</code> or <code>MD.plot2</code> functions. <code>MD.plot1</code> will create a side by side MD plot showing before and after loess normalization. Enter your original M and D vectors along with the M correction factor, <code>mc</code>, calculated by <code>hic_loess</code>. The <code>smooth</code> option controls if the plot is plotted using <code>smoothScatter</code> or as a <code>ggplot2</code> scatter plot.</p>
<div class="sourceCode" id="cb44"><pre class="downlit">
<span class="fu"><a href="../reference/MD.plot1.html">MD.plot1</a></span>(M = <span class="kw">hic.table</span><span class="op">$</span><span class="kw">M</span>, D = <span class="kw">hic.table</span><span class="op">$</span><span class="kw">D</span>, mc = <span class="kw">hic.table</span><span class="op">$</span><span class="kw">mc</span>, smooth = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="HiCcompare-vignette_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
<p><code>MD.plot2</code> will create a standard MD plot with optional coloring based on p-value. Just enter an M and D vector and a p-value vector if desired.</p>
<div class="sourceCode" id="cb45"><pre class="downlit">
<span class="co"># no p-value coloring</span>
<span class="fu"><a href="../reference/MD.plot2.html">MD.plot2</a></span>(M = <span class="kw">hic.table</span><span class="op">$</span><span class="kw">adj.M</span>, D = <span class="kw">hic.table</span><span class="op">$</span><span class="kw">D</span>, smooth = <span class="fl">FALSE</span>)
</pre></div>
<p><img src="HiCcompare-vignette_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
<div class="sourceCode" id="cb46"><pre class="downlit">
<span class="co"># p-value coloring</span>
<span class="fu"><a href="../reference/MD.plot2.html">MD.plot2</a></span>(M = <span class="kw">hic.table</span><span class="op">$</span><span class="kw">adj.M</span>, D = <span class="kw">hic.table</span><span class="op">$</span><span class="kw">D</span>, <span class="kw">hic.table</span><span class="op">$</span><span class="kw">p.value</span>, smooth = <span class="fl">FALSE</span>)
</pre></div>
<p><img src="HiCcompare-vignette_files/figure-html/unnamed-chunk-25-2.png" width="672"></p>
<p>There are two matrix transformation functions included. <code>sparse2full</code> will transform a sparse upper triangular matrix to a full Hi-C matrix. <code>full2sparse</code> will transform a full Hi-C matrix to sparse upper triangular format.</p>
<div class="sourceCode" id="cb47"><pre class="downlit">
<span class="kw">full.NHEK</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sparse2full.html">sparse2full</a></span>(<span class="kw">NHEK.chr22</span>)
</pre></div>
<pre><code>## Matrix dimensions: 71x71</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit">
<span class="kw">full.NHEK</span>[<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>]
</pre></div>
<pre><code>##          1.6e+07 16500000 1.7e+07 17500000 1.8e+07
## 1.6e+07        6       10      17       13       1
## 16500000      10      554     320      118      23
## 1.7e+07       17      320   10880     2922     576
## 17500000      13      118    2922    27545    3693
## 1.8e+07        1       23     576     3693   25794</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit">
<span class="kw">sparse.NHEK</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/full2sparse.html">full2sparse</a></span>(<span class="kw">full.NHEK</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">sparse.NHEK</span>)
</pre></div>
<pre><code>##     region1  region2    IF
## 1: 16000000 16000000     6
## 2: 16000000 16500000    10
## 3: 16500000 16500000   554
## 4: 16000000 17000000    17
## 5: 16500000 17000000   320
## 6: 17000000 17000000 10880</code></pre>
<p><code>KRnorm</code> will perform Knight-Ruiz normalization on a Hi-C matrix. Just enter the full Hi-C matrix to be normalized.</p>
<div class="sourceCode" id="cb53"><pre class="downlit">
<span class="kw">KR.NHEK</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/KRnorm.html">KRnorm</a></span>(<span class="kw">full.NHEK</span>)
</pre></div>
<p><code>SCN</code> will perform Sequential Component Normalization on a Hi-C matrix. Just enter the full Hi-C matrix to be normalized.</p>
<div class="sourceCode" id="cb54"><pre class="downlit">
<span class="kw">SCN.NHEK</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SCN.html">SCN</a></span>(<span class="kw">full.NHEK</span>)
</pre></div>
<p><code>MA_norm</code> will perform MA normalization on a <code>hic.table</code> object.</p>
<div class="sourceCode" id="cb55"><pre class="downlit">
<span class="kw">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MA_norm.html">MA_norm</a></span>(<span class="kw">hic.table</span>, Plot = <span class="fl">TRUE</span>)
</pre></div>
<p><img src="HiCcompare-vignette_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
</div>
<div id="using-hiccompare-on-a-cluster" class="section level2">
<h2 class="hasAnchor">
<a href="#using-hiccompare-on-a-cluster" class="anchor"></a>Using HiCcompare on a cluster</h2>
<p>Below is an example script for using <code>HiCcompare</code> on a computing cluster. The data was concatenated into a single sparse matrix for each group, containing information for all the chromosomes.</p>
<div class="sourceCode" id="cb56"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">HiCcompare</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/Bioconductor/BiocParallel">BiocParallel</a></span>)

<span class="kw">args</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/commandArgs.html">commandArgs</a></span>(trailingOnly=<span class="fl">TRUE</span>)

<span class="kw">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">args</span>[<span class="fl">1</span>], header=<span class="fl">FALSE</span>, col.names=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"chr1"</span>, <span class="st">"start1"</span>, <span class="st">"end1"</span>, <span class="st">"chr2"</span>, <span class="st">"start2"</span>, <span class="st">"end2"</span>, <span class="st">"IF"</span>))
<span class="kw">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="kw">args</span>[<span class="fl">2</span>], header=<span class="fl">FALSE</span>, col.names=<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"chr1"</span>, <span class="st">"start1"</span>, <span class="st">"end1"</span>, <span class="st">"chr2"</span>, <span class="st">"start2"</span>, <span class="st">"end2"</span>, <span class="st">"IF"</span>))

<span class="kw">dat1</span> <span class="op">&lt;-</span> <span class="kw">dat1</span>[<span class="kw">dat1</span><span class="op">$</span><span class="kw">chr1</span><span class="op">==</span><span class="kw">dat1</span><span class="op">$</span><span class="kw">chr2</span>, ]
<span class="kw">dat2</span> <span class="op">&lt;-</span> <span class="kw">dat2</span>[<span class="kw">dat2</span><span class="op">$</span><span class="kw">chr1</span><span class="op">==</span><span class="kw">dat2</span><span class="op">$</span><span class="kw">chr2</span>, ]

<span class="kw">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span>(<span class="kw">dat1</span>, <span class="kw">dat1</span><span class="op">$</span><span class="kw">chr1</span>)
<span class="kw">dat2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span>(<span class="kw">dat2</span>, <span class="kw">dat2</span><span class="op">$</span><span class="kw">chr1</span>)

<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span>(<span class="kw">create.hic.table</span>, <span class="kw">dat1</span>, <span class="kw">dat2</span>, SIMPLIFY = <span class="fl">FALSE</span>, scale=<span class="fl">FALSE</span>)

<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/total_sum.html">total_sum</a></span>(<span class="kw">hic.list</span>)

<span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html">register</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/MulticoreParam-class.html">MulticoreParam</a></span>(workers = <span class="fl">10</span>), default = <span class="fl">TRUE</span>)

<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_loess.html">hic_loess</a></span>(<span class="kw">hic.list</span>, Plot=<span class="fl">TRUE</span>, parallel=<span class="fl">TRUE</span>)
<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hic_compare.html">hic_compare</a></span>(<span class="kw">hic.list</span>, A.min = <span class="fl">NA</span>, adjust.dist = <span class="fl">TRUE</span>, p.method = <span class="st">'fdr'</span>, Plot = <span class="fl">TRUE</span>, parallel=<span class="fl">TRUE</span>)

<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="kw">rbind</span>, <span class="kw">hic.list</span>)

<span class="kw">hic.list</span> <span class="op">&lt;-</span> <span class="kw">hic.list</span>[<span class="kw">hic.list</span><span class="op">$</span><span class="kw">p.adj</span><span class="op">&lt;</span><span class="fl">0.05</span>,]

<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.table</a></span>(<span class="kw">hic.list</span>, <span class="kw">args</span>[<span class="fl">3</span>])
</pre></div>
<p>The above can be saved as an R script and then submitted to a cluster using the following submission script.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true"></a><span class="co">#!/bin/sh</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true"></a><span class="co"># Sun Grid Engine options (lines prefixed with #$)</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true"></a><span class="co">#$ -cwd</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true"></a><span class="co">#$ -N HiCCompare</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true"></a><span class="co">#$ -l h_rt=06:00:00</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true"></a><span class="co">#$ -l h_vmem=32G</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true"></a><span class="co">#$ -pe sharedmem 11</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true"></a><span class="co">#$ -V</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true"></a><span class="ex">Rscript</span> 01_HiCcompare.R <span class="va">$1</span> <span class="va">$2</span> <span class="va">$3</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true"></a><span class="ex">qsub</span> 01_launch_HiCcompare.sh dat1.1000000.pixels.tsv dat2.1000000.pixels.tsv hiccompare_1Mb.tsv</span></code></pre></div>
<p>Credit to Ilya Flyamer (<span class="citation">@Phlya</span> on GitHub) for this example of using <code>HiCcompare</code> on a cluster.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by John Stansfield.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
